{"version":3,"sources":["../../src/di/di.js"],"names":["mediator","serverSettings","dbSettings","database","models","once","on","db","container","register","validate","user","emit","err","connect"],"mappings":";;;;;;;AAAA;;AAEA;eAEe,wBAAgDA,QAAhD,EAA6D;AAAA,MAA1DC,cAA0D,QAA1DA,cAA0D;AAAA,MAA3CC,UAA2C,QAA3CA,UAA2C;AAAA,MAAhCC,QAAgC,QAAhCA,QAAgC;AAAA,MAAvBC,MAAuB,QAAvBA,MAAuB;AAE1EJ,EAAAA,QAAQ,CAACK,IAAT,CAAc,MAAd,EAAsB,YAAM;AAC5B;AACEL,IAAAA,QAAQ,CAACM,EAAT,CAAY,UAAZ,EAAwB,UAAAC,EAAE,EAAI;AAC5B,UAAMC,SAAS,GAAG,8BAAlB;AAEAA,MAAAA,SAAS,CAACC,QAAV,CAAmB;AACjBN,QAAAA,QAAQ,EAAE,qBAAQI,EAAR,CADO;AAEjBN,QAAAA,cAAc,EAAE,qBAAQA,cAAR,CAFC;AAGvB;AACMS,QAAAA,QAAQ,EAAE,qBAAQN,MAAM,CAACM,QAAf,CAJO;AAKjBC,QAAAA,IAAI,EAAE,qBAAQP,MAAM,CAACO,IAAf;AALW,OAAnB;AAQAX,MAAAA,QAAQ,CAACY,IAAT,CAAc,UAAd,EAA0BJ,SAA1B;AACD,KAZD,EAF0B,CAgB5B;;AACER,IAAAA,QAAQ,CAACM,EAAT,CAAY,UAAZ,EAAwB,UAAAO,GAAG,EAAI;AAAEb,MAAAA,QAAQ,CAACY,IAAT,CAAc,UAAd;AAA2B,KAA5D,EAjB0B,CAmB5B;;AACET,IAAAA,QAAQ,CAACW,OAAT,CAAkBZ,UAAlB,EAA6BF,QAA7B,EApB0B,CAsB5B;;AACEA,IAAAA,QAAQ,CAACY,IAAT,CAAc,YAAd;AACD,GAxBD;AA2BD,C","sourcesContent":["import { createContainer,asValue } from 'awilix'\r\n\r\n// CREATE DEPENDENCIES Object: db,models,services:\r\n\r\nexport default ({ serverSettings,dbSettings,database,models }, mediator) => {\r\n\r\n  mediator.once('init', () => {\r\n  // create dependencies Container object:\r\n    mediator.on('db.ready', db => {\r\n      const container = createContainer()\r\n\r\n      container.register({\r\n        database: asValue(db),\r\n        serverSettings: asValue(serverSettings),\r\n  // add models and data validation: joi library\r\n        validate: asValue(models.validate),\r\n        user: asValue(models.user)\r\n      })\r\n\r\n      mediator.emit('di.ready', container)\r\n    })\r\n\r\n  // DB error handling:\r\n    mediator.on('db.error', err => { mediator.emit('di.error') })\r\n\r\n  // CONNECT MYSQL DB:\r\n    database.connect( dbSettings,mediator )\r\n\r\n  // Initiate reboot -> DB createsPool:\r\n    mediator.emit('boot.ready')\r\n  })\r\n\r\n\r\n}\r\n"],"file":"di.js"}